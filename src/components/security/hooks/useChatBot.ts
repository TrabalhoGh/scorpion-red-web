import { useState, useRef, useEffect } from "react";
import { Message, AttackSimulation } from "../types";
import { getRandomAttack } from "../data/attackSimulations";

export const useChatBot = () => {
  const [activeBot, setActiveBot] = useState<"z3r0" | "airon">("z3r0");
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState("");
  const [userScore, setUserScore] = useState(0);
  const [isAttackActive, setIsAttackActive] = useState(false);
  const [isQuizActive, setIsQuizActive] = useState(false);
  const [currentAttack, setCurrentAttack] = useState<AttackSimulation | null>(null);
  const [selectedQuizOption, setSelectedQuizOption] = useState<number | null>(null);
  
  const messagesEndRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (messagesEndRef.current) {
      messagesEndRef.current.scrollIntoView({ behavior: "smooth" });
    }
  }, [messages]);

  useEffect(() => {
    const initialZ3r0Message = {
      id: "z3r0-initial",
      sender: "ai" as const,
      content: "Hello user. I am Z3R0, your security testing assistant. I will simulate various cyber attacks to test your security awareness. After each simulation, you'll get a quiz to test your knowledge. I have over 30 different attack scenarios ready. Type anything to begin...",
      timestamp: new Date(),
      bot: "z3r0" as const
    };

    const initialAironMessage = {
      id: "airon-initial",
      sender: "ai" as const,
      content: "Hello! I'm AI-ron, your cybersecurity defense consultant. I'm here to provide comprehensive guidance on information security best practices. I can help you with security policies, risk management, compliance, incident response, and much more. What security topic would you like to explore?",
      timestamp: new Date(),
      bot: "airon" as const
    };

    setMessages([initialZ3r0Message, initialAironMessage]);
  }, []);

  const handleQuizSubmit = () => {
    if (selectedQuizOption === null || !currentAttack) return;

    const isCorrect = selectedQuizOption === currentAttack.quiz.correctAnswer;
    const quizPoints = isCorrect ? currentAttack.points + 50 : Math.floor(currentAttack.points / 2);

    const resultMessage: Message = {
      id: `z3r0-quiz-result-${Date.now()}`,
      sender: "ai",
      content: isCorrect 
        ? `üéØ Correto! Voc√™ identificou corretamente o ataque. +${quizPoints} pontos!\n\n${currentAttack.quiz.explanation}`
        : `‚ùå Resposta incorreta. A resposta correta era: ${currentAttack.quiz.options[currentAttack.quiz.correctAnswer]}.\n\n${currentAttack.quiz.explanation}`,
      timestamp: new Date(),
      bot: "z3r0"
    };

    setMessages(prev => [...prev, resultMessage]);

    if (isCorrect) {
      setUserScore(prev => prev + quizPoints);
    }

    setTimeout(() => {
      const preventionMessage: Message = {
        id: `z3r0-prevention-${Date.now()}`,
        sender: "ai",
        content: `üìö Como se proteger contra ${currentAttack.attackType}:\n\n${currentAttack.quiz.prevention}`,
        timestamp: new Date(),
        bot: "z3r0"
      };

      setMessages(prev => [...prev, preventionMessage]);

      setTimeout(() => {
        setIsQuizActive(false);
        setCurrentAttack(null);
        setSelectedQuizOption(null);

        const nextPromptMessage: Message = {
          id: `z3r0-next-${Date.now()}`,
          sender: "ai",
          content: "Ready for another security challenge? I have many more attack simulations and quizzes to test your skills. Type anything to continue.",
          timestamp: new Date(),
          bot: "z3r0"
        };

        setMessages(prev => [...prev, nextPromptMessage]);
      }, 1500);
    }, 1000);
  };

  const handleZ3r0Response = (userInput: string) => {
    setTimeout(() => {
      if (!isAttackActive && !isQuizActive) {
        const attack = getRandomAttack();
        setCurrentAttack(attack);
        setIsAttackActive(true);
        
        const attackMessage: Message = {
          id: `z3r0-${Date.now()}`,
          sender: "ai",
          content: attack.attack,
          timestamp: new Date(),
          bot: "z3r0"
        };
        
        setMessages(prev => [...prev, attackMessage]);
      } else if (isAttackActive && currentAttack && !isQuizActive) {
        const userDetectedThreat = userInput.toLowerCase().includes("attack") || 
                                  userInput.toLowerCase().includes("threat") ||
                                  userInput.toLowerCase().includes("scam") ||
                                  userInput.toLowerCase().includes("phishing") ||
                                  userInput.toLowerCase().includes("suspicious") ||
                                  userInput.toLowerCase().includes("fraud") ||
                                  userInput.toLowerCase().includes("fake") ||
                                  userInput.toLowerCase().includes("malicious") ||
                                  userInput.toLowerCase().includes("no") ||
                                  userInput.toLowerCase().includes("don't trust") ||
                                  userInput.toLowerCase().includes("verify");
        
        if (userDetectedThreat) {
          const successMessage: Message = {
            id: `z3r0-${Date.now()}`,
            sender: "ai",
            content: `Good eye! You detected something suspicious. You've earned ${currentAttack.points} points! üéØ`,
            timestamp: new Date(),
            bot: "z3r0"
          };
          
          setMessages(prev => [...prev, successMessage]);
          setUserScore(prev => prev + currentAttack.points);
        } else {
          const failMessage: Message = {
            id: `z3r0-${Date.now()}`,
            sender: "ai",
            content: `That was a security test, and you didn't identify the threat initially. ${currentAttack.defense} ‚ö†Ô∏è`,
            timestamp: new Date(),
            bot: "z3r0"
          };
          
          setMessages(prev => [...prev, failMessage]);
        }

        setTimeout(() => {
          setIsAttackActive(false);
          setIsQuizActive(true);

          const quizMessage: Message = {
            id: `z3r0-quiz-${Date.now()}`,
            sender: "ai",
            content: "",
            timestamp: new Date(),
            bot: "z3r0",
            type: "quiz",
            quizData: currentAttack.quiz
          };

          setMessages(prev => [...prev, quizMessage]);
        }, 1000);
      }
    }, 1000);
  };

  const handleAIronResponse = (userInput: string) => {
    setTimeout(() => {
      const lowerInput = userInput.toLowerCase();
      let responseContent = "";
      
      if (lowerInput.includes("pol√≠tica") || lowerInput.includes("policy") || lowerInput.includes("pol√≠ticas")) {
        responseContent = "üìã **Pol√≠ticas de Seguran√ßa da Informa√ß√£o:**\n\n1. **Pol√≠tica de Senhas:** Senhas complexas (8+ caracteres, mai√∫sculas, min√∫sculas, n√∫meros, s√≠mbolos), renova√ß√£o a cada 90 dias, sem reutiliza√ß√£o das √∫ltimas 12 senhas\n\n2. **Pol√≠tica de Acesso:** Princ√≠pio do menor privil√©gio, revis√£o trimestral de acessos, segrega√ß√£o de fun√ß√µes\n\n3. **Pol√≠tica de Backup:** Backup di√°rio autom√°tico, teste mensal de restaura√ß√£o, armazenamento em locais seguros\n\n4. **Pol√≠tica de Dispositivos:** Antiv√≠rus atualizado, firewall ativo, criptografia de disco, bloqueio autom√°tico\n\n5. **Pol√≠tica de Incidentes:** Procedimentos claros de resposta, equipe respons√°vel definida, comunica√ß√£o estruturada";
      } else if (lowerInput.includes("compliance") || lowerInput.includes("conformidade") || lowerInput.includes("lgpd") || lowerInput.includes("gdpr")) {
        responseContent = "‚öñÔ∏è **Compliance e Conformidade:**\n\n**LGPD (Lei Geral de Prote√ß√£o de Dados):**\n‚Ä¢ Mapeamento de dados pessoais\n‚Ä¢ Implementa√ß√£o de medidas de seguran√ßa\n‚Ä¢ Nomea√ß√£o de DPO (Data Protection Officer)\n‚Ä¢ Procedimentos para direitos dos titulares\n‚Ä¢ Relat√≥rios de impacto √† prote√ß√£o de dados\n\n**ISO 27001:**\n‚Ä¢ Sistema de Gest√£o de Seguran√ßa da Informa√ß√£o\n‚Ä¢ An√°lise de riscos estruturada\n‚Ä¢ Controles de seguran√ßa implementados\n‚Ä¢ Monitoramento e melhoria cont√≠nua\n\n**SOX, PCI-DSS:** Controles espec√≠ficos para dados financeiros e de cart√£o";
      } else if (lowerInput.includes("risco") || lowerInput.includes("risk") || lowerInput.includes("an√°lise")) {
        responseContent = "üéØ **Gest√£o de Riscos de Seguran√ßa:**\n\n**1. Identifica√ß√£o de Riscos:**\n‚Ä¢ Amea√ßas internas e externas\n‚Ä¢ Vulnerabilidades t√©cnicas e humanas\n‚Ä¢ Impactos no neg√≥cio\n\n**2. An√°lise Qualitativa:**\n‚Ä¢ Probabilidade: Muito baixa, Baixa, M√©dia, Alta, Muito alta\n‚Ä¢ Impacto: Insignificante, Menor, Moderado, Maior, Catastr√≥fico\n\n**3. Estrat√©gias de Tratamento:**\n‚Ä¢ Mitigar: Implementar controles\n‚Ä¢ Transferir: Seguros, terceiriza√ß√£o\n‚Ä¢ Aceitar: Riscos residuais baixos\n‚Ä¢ Evitar: Eliminar a atividade\n\n**4. Monitoramento:** KPIs, m√©tricas, revis√µes peri√≥dicas";
      } else if (lowerInput.includes("incidente") || lowerInput.includes("incident") || lowerInput.includes("resposta")) {
        responseContent = "üö® **Resposta a Incidentes de Seguran√ßa:**\n\n**Fases do Processo:**\n\n**1. Prepara√ß√£o:**\n‚Ä¢ Equipe de resposta treinada\n‚Ä¢ Ferramentas e procedimentos definidos\n‚Ä¢ Comunica√ß√£o com stakeholders\n\n**2. Identifica√ß√£o:**\n‚Ä¢ Monitoramento cont√≠nuo\n‚Ä¢ Alertas automatizados\n‚Ä¢ An√°lise de logs e eventos\n\n**3. Conten√ß√£o:**\n‚Ä¢ Isolamento do sistema afetado\n‚Ä¢ Preserva√ß√£o de evid√™ncias\n‚Ä¢ Conten√ß√£o de curto e longo prazo\n\n**4. Erradica√ß√£o:**\n‚Ä¢ Remo√ß√£o da causa raiz\n‚Ä¢ Corre√ß√£o de vulnerabilidades\n\n**5. Recupera√ß√£o:**\n‚Ä¢ Restaura√ß√£o de sistemas\n‚Ä¢ Monitoramento intensivo\n\n**6. Li√ß√µes Aprendidas:**\n‚Ä¢ Documenta√ß√£o do incidente\n‚Ä¢ Melhoria dos processos";
      } else if (lowerInput.includes("criptografia") || lowerInput.includes("encryption") || lowerInput.includes("crypto")) {
        responseContent = "üîê **Criptografia e Prote√ß√£o de Dados:**\n\n**Dados em Repouso:**\n‚Ä¢ AES-256 para arquivos e bancos de dados\n‚Ä¢ Criptografia de disco completo\n‚Ä¢ Chaves gerenciadas em HSM/KMS\n\n**Dados em Tr√¢nsito:**\n‚Ä¢ TLS 1.3 para comunica√ß√µes web\n‚Ä¢ VPN para acesso remoto\n‚Ä¢ Certificados digitais v√°lidos\n\n**Gest√£o de Chaves:**\n‚Ä¢ Rota√ß√£o regular de chaves\n‚Ä¢ Separa√ß√£o de ambientes\n‚Ä¢ Backup seguro de chaves\n‚Ä¢ Controle de acesso rigoroso\n\n**Assinatura Digital:**\n‚Ä¢ Certificados ICP-Brasil\n‚Ä¢ Timestamping para integridade\n‚Ä¢ Valida√ß√£o de certificados";
      } else if (lowerInput.includes("monitoramento") || lowerInput.includes("monitoring") || lowerInput.includes("siem")) {
        responseContent = "üìä **Monitoramento e SIEM:**\n\n**Componentes Essenciais:**\n\n**1. Coleta de Logs:**\n‚Ä¢ Sistemas operacionais\n‚Ä¢ Aplica√ß√µes cr√≠ticas\n‚Ä¢ Dispositivos de rede\n‚Ä¢ Sistemas de seguran√ßa\n\n**2. Correla√ß√£o de Eventos:**\n‚Ä¢ Regras de detec√ß√£o personalizadas\n‚Ä¢ Machine learning para anomalias\n‚Ä¢ Integra√ß√£o com threat intelligence\n\n**3. Alertas Inteligentes:**\n‚Ä¢ Prioriza√ß√£o por criticidade\n‚Ä¢ Redu√ß√£o de falsos positivos\n‚Ä¢ Escala√ß√£o autom√°tica\n\n**4. Dashboards:**\n‚Ä¢ Vis√£o executiva\n‚Ä¢ M√©tricas operacionais\n‚Ä¢ Indicadores de risco\n\n**5. Resposta Automatizada:**\n‚Ä¢ Bloqueio de IPs maliciosos\n‚Ä¢ Isolamento de sistemas\n‚Ä¢ Notifica√ß√µes imediatas";
      } else if (lowerInput.includes("treinamento") || lowerInput.includes("training") || lowerInput.includes("conscientiza√ß√£o")) {
        responseContent = "üéì **Treinamento e Conscientiza√ß√£o:**\n\n**Programa Estruturado:**\n\n**1. Treinamento Inicial:**\n‚Ä¢ Pol√≠ticas de seguran√ßa\n‚Ä¢ Senhas seguras\n‚Ä¢ Phishing e engenharia social\n‚Ä¢ Uso seguro de dispositivos\n\n**2. Treinamentos Espec√≠ficos:**\n‚Ä¢ Por fun√ß√£o/departamento\n‚Ä¢ Administradores de sistema\n‚Ä¢ Desenvolvedores\n‚Ä¢ Executivos (whaling)\n\n**3. Simula√ß√µes Pr√°ticas:**\n‚Ä¢ Phishing simulado\n‚Ä¢ Testes de engenharia social\n‚Ä¢ Exerc√≠cios de resposta a incidentes\n\n**4. Avalia√ß√£o Cont√≠nua:**\n‚Ä¢ Testes de conhecimento\n‚Ä¢ M√©tricas de comportamento\n‚Ä¢ Feedback e melhoria\n\n**5. Cultura de Seguran√ßa:**\n‚Ä¢ Comunica√ß√£o regular\n‚Ä¢ Reconhecimento de boas pr√°ticas\n‚Ä¢ Canal de den√∫ncias";
      } else if (lowerInput.includes("arquitetura") || lowerInput.includes("architecture") || lowerInput.includes("design")) {
        responseContent = "üèóÔ∏è **Arquitetura de Seguran√ßa:**\n\n**Princ√≠pios Fundamentais:**\n\n**1. Defesa em Profundidade:**\n‚Ä¢ M√∫ltiplas camadas de prote√ß√£o\n‚Ä¢ Controles preventivos, detectivos e corretivos\n‚Ä¢ Redund√¢ncia de seguran√ßa\n\n**2. Zero Trust:**\n‚Ä¢ Nunca confie, sempre verifique\n‚Ä¢ Microsegmenta√ß√£o de rede\n‚Ä¢ Autentica√ß√£o cont√≠nua\n‚Ä¢ Menor privil√©gio\n\n**3. Seguran√ßa por Design:**\n‚Ä¢ Security by Design desde o in√≠cio\n‚Ä¢ Privacy by Design\n‚Ä¢ Modelagem de amea√ßas\n‚Ä¢ Revis√µes de seguran√ßa\n\n**4. Componentes T√©cnicos:**\n‚Ä¢ Firewalls e IPS/IDS\n‚Ä¢ WAF (Web Application Firewall)\n‚Ä¢ DLP (Data Loss Prevention)\n‚Ä¢ IAM (Identity Access Management)\n‚Ä¢ SIEM/SOAR\n‚Ä¢ Backup e Disaster Recovery";
      } else if (lowerInput.includes("terceiros") || lowerInput.includes("fornecedor") || lowerInput.includes("vendor")) {
        responseContent = "ü§ù **Gest√£o de Seguran√ßa de Terceiros:**\n\n**Due Diligence:**\n‚Ä¢ Avalia√ß√£o de seguran√ßa inicial\n‚Ä¢ Certifica√ß√µes e conformidade\n‚Ä¢ Hist√≥rico de incidentes\n‚Ä¢ Controles implementados\n\n**Contratos e SLAs:**\n‚Ä¢ Cl√°usulas de seguran√ßa\n‚Ä¢ Responsabilidades definidas\n‚Ä¢ Direito de auditoria\n‚Ä¢ Notifica√ß√£o de incidentes\n\n**Monitoramento Cont√≠nuo:**\n‚Ä¢ Reavalia√ß√µes peri√≥dicas\n‚Ä¢ Testes de seguran√ßa\n‚Ä¢ M√©tricas de performance\n‚Ä¢ Gest√£o de vulnerabilidades\n\n**Acesso e Integra√ß√£o:**\n‚Ä¢ Princ√≠pio do menor privil√©gio\n‚Ä¢ Segrega√ß√£o de ambientes\n‚Ä¢ Monitoramento de atividades\n‚Ä¢ Revoga√ß√£o de acessos";
      } else if (lowerInput.includes("email") || lowerInput.includes("phishing")) {
        responseContent = "üìß **Seguran√ßa de Email - Guia Completo:**\n\n**Identifica√ß√£o de Phishing:**\n‚Ä¢ Verifique o remetente real (n√£o apenas o nome exibido)\n‚Ä¢ Examine URLs antes de clicar (hover sobre links)\n‚Ä¢ Desconfie de urg√™ncia excessiva\n‚Ä¢ Procure erros de ortografia/gram√°tica\n‚Ä¢ Questione solicita√ß√µes n√£o usuais\n\n**Prote√ß√µes T√©cnicas:**\n‚Ä¢ SPF, DKIM e DMARC configurados\n‚Ä¢ Gateway de email com antispam\n‚Ä¢ Quarentena de anexos suspeitos\n‚Ä¢ Sandboxing de links\n\n**Boas Pr√°ticas:**\n‚Ä¢ Nunca forne√ßa credenciais via email\n‚Ä¢ Use canais alternativos para verificar\n‚Ä¢ Reporte emails suspeitos\n‚Ä¢ Mantenha software atualizado";
      } else if (lowerInput.includes("password") || lowerInput.includes("senha")) {
        responseContent = "üîë **Gest√£o Segura de Senhas:**\n\n**Crit√©rios T√©cnicos:**\n‚Ä¢ M√≠nimo 12 caracteres\n‚Ä¢ Combina√ß√£o: mai√∫sculas + min√∫sculas + n√∫meros + s√≠mbolos\n‚Ä¢ Evitar informa√ß√µes pessoais\n‚Ä¢ Sem palavras do dicion√°rio\n‚Ä¢ √önica para cada conta\n\n**Gerenciamento:**\n‚Ä¢ Use gerenciador de senhas confi√°vel\n‚Ä¢ Ative autentica√ß√£o multifator (MFA)\n‚Ä¢ Altere senhas comprometidas imediatamente\n‚Ä¢ Revise acessos regularmente\n\n**Pol√≠ticas Organizacionais:**\n‚Ä¢ Renova√ß√£o baseada em risco\n‚Ä¢ Hist√≥rico de senhas\n‚Ä¢ Bloqueio ap√≥s tentativas\n‚Ä¢ Educa√ß√£o cont√≠nua\n\n**Alternativas Modernas:**\n‚Ä¢ Autentica√ß√£o biom√©trica\n‚Ä¢ Tokens de hardware\n‚Ä¢ Certificados digitais";
      } else if (lowerInput.includes("mobile") || lowerInput.includes("celular") || lowerInput.includes("smartphone")) {
        responseContent = "üì± **Seguran√ßa Mobile (MDM/MAM):**\n\n**Mobile Device Management:**\n‚Ä¢ Pol√≠tica de dispositivos definida\n‚Ä¢ Configura√ß√µes de seguran√ßa for√ßadas\n‚Ä¢ Invent√°rio e controle central\n‚Ä¢ Wipe remoto em caso de perda\n\n**Aplica√ß√µes:**\n‚Ä¢ App store corporativo\n‚Ä¢ Containeriza√ß√£o de dados empresariais\n‚Ä¢ Preven√ß√£o de jailbreak/root\n‚Ä¢ Controle de instala√ß√£o de apps\n\n**Dados:**\n‚Ä¢ Criptografia obrigat√≥ria\n‚Ä¢ Backup seguro\n‚Ä¢ Segrega√ß√£o pessoal/corporativo\n‚Ä¢ DLP para dispositivos m√≥veis\n\n**Rede:**\n‚Ä¢ VPN obrigat√≥ria\n‚Ä¢ Controle de WiFi\n‚Ä¢ Certificados para autentica√ß√£o\n‚Ä¢ Monitoramento de tr√°fego";
      } else if (lowerInput.includes("cloud") || lowerInput.includes("nuvem")) {
        responseContent = "‚òÅÔ∏è **Seguran√ßa em Cloud:**\n\n**Modelo de Responsabilidade Compartilhada:**\n‚Ä¢ Provider: Seguran√ßa DA nuvem\n‚Ä¢ Cliente: Seguran√ßa NA nuvem\n‚Ä¢ Entender limites claramente\n\n**Configura√ß√£o Segura:**\n‚Ä¢ IAM com menor privil√©gio\n‚Ä¢ Criptografia em repouso e tr√¢nsito\n‚Ä¢ Configura√ß√µes de rede (VPC, Security Groups)\n‚Ä¢ Logging e monitoramento ativados\n\n**Governan√ßa:**\n‚Ä¢ Cloud Security Posture Management (CSPM)\n‚Ä¢ Pol√≠ticas de uso definidas\n‚Ä¢ Invent√°rio de recursos\n‚Ä¢ Gest√£o de custos e compliance\n\n**Multi-Cloud:**\n‚Ä¢ Estrat√©gia de backup entre providers\n‚Ä¢ Pol√≠ticas consistentes\n‚Ä¢ Ferramentas unificadas de gest√£o";
      } else if (lowerInput.includes("help") || lowerInput.includes("ajuda") || lowerInput.includes("tip") || lowerInput.includes("advice")) {
        responseContent = "üõ°Ô∏è **Central de Orienta√ß√µes de Seguran√ßa:**\n\nEscolha um t√≥pico para orienta√ß√µes detalhadas:\n\nüìã **Pol√≠ticas** - Desenvolvimento de pol√≠ticas de seguran√ßa\n‚öñÔ∏è **Compliance** - LGPD, ISO 27001, SOX, PCI-DSS\nüéØ **Gest√£o de Riscos** - An√°lise e tratamento de riscos\nüö® **Resposta a Incidentes** - Procedimentos e melhores pr√°ticas\nüîê **Criptografia** - Prote√ß√£o de dados em repouso e tr√¢nsito\nüìä **Monitoramento** - SIEM, logs e alertas\nüéì **Treinamento** - Conscientiza√ß√£o e educa√ß√£o\nüèóÔ∏è **Arquitetura** - Zero Trust, defesa em profundidade\nü§ù **Terceiros** - Gest√£o de fornecedores\nüì± **Mobile** - MDM/MAM e seguran√ßa m√≥vel\n‚òÅÔ∏è **Cloud** - Seguran√ßa em ambiente de nuvem\n\nDigite qualquer palavra-chave para orienta√ß√µes espec√≠ficas!";
      } else {
        responseContent = "ü§ñ **AI-ron - Consultor de Defesa Cibern√©tica**\n\nEstou aqui para ajudar com orienta√ß√µes abrangentes sobre seguran√ßa da informa√ß√£o! Posso fornecer:\n\n‚Ä¢ **Pol√≠ticas e Procedimentos** de seguran√ßa\n‚Ä¢ **An√°lise e Gest√£o de Riscos**\n‚Ä¢ **Compliance** (LGPD, ISO 27001, etc.)\n‚Ä¢ **Arquitetura de Seguran√ßa**\n‚Ä¢ **Resposta a Incidentes**\n‚Ä¢ **Treinamento e Conscientiza√ß√£o**\n‚Ä¢ **Seguran√ßa em Cloud**\n‚Ä¢ **Gest√£o de Terceiros**\n\nQual √°rea de seguran√ßa voc√™ gostaria de explorar? Digite uma palavra-chave ou 'ajuda' para ver todas as op√ß√µes dispon√≠veis.";
      }
      
      const aironMessage: Message = {
        id: `airon-${Date.now()}`,
        sender: "ai",
        content: responseContent,
        timestamp: new Date(),
        bot: "airon"
      };
      
      setMessages(prev => [...prev, aironMessage]);
    }, 1000);
  };

  const handleSendMessage = () => {
    if (!input.trim()) return;
    
    const userMessage: Message = {
      id: `user-${Date.now()}`,
      sender: "user",
      content: input,
      timestamp: new Date(),
      bot: activeBot
    };
    
    setMessages(prev => [...prev, userMessage]);
    setInput("");
    
    if (activeBot === "z3r0") {
      handleZ3r0Response(input);
    } else {
      handleAIronResponse(input);
    }
  };

  return {
    activeBot,
    setActiveBot,
    messages,
    input,
    setInput,
    userScore,
    isQuizActive,
    selectedQuizOption,
    setSelectedQuizOption,
    handleSendMessage,
    handleQuizSubmit,
    messagesEndRef
  };
};
